{% extends 'cryptix_app/base.html' %}

{% block title %}{{ group.name }}{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: start;">
        <div>
            {% if group.avatar %}
            <img src="{{ group.avatar.url }}" alt="{{ group.name }}" style="width: 100px; height: 100px; border-radius: 12px; margin-right: 15px; float: left;">
            {% endif %}
            <h2>{{ group.name }}</h2>
            <p style="color: #666;">{{ group.description }}</p>
            <small style="color: #999;">{{ group.members_count }} учасників • Створена {{ group.created_at|date:"d.m.Y" }}</small>
        </div>
        <div>
            {% if is_member %}
                {% if membership.role == 'admin' %}
                    <form method="post" action="{% url 'group_delete' group.id %}" style="display: inline;" onsubmit="return confirm('Ви впевнені?');">
                        {% csrf_token %}
                        <button type="submit" style="background: #f44336;">Видалити групу</button>
                    </form>
                {% else %}
                    <form method="post" action="{% url 'group_leave' group.id %}">
                        {% csrf_token %}
                        <button type="submit" style="background: #999;">Покинути</button>
                    </form>
                {% endif %}
            {% else %}
                <form method="post" action="{% url 'group_join' group.id %}">
                    {% csrf_token %}
                    <button type="submit">Приєднатися</button>
                </form>
            {% endif %}
        </div>
    </div>
</div>

{% if is_member %}
<div class="card">
    <h3>Створити пост</h3>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <textarea name="post_content" placeholder="Що у вас нового?" rows="3" required></textarea>
        <input type="file" name="post_image" accept="image/*">
        <button type="submit">Опублікувати</button>
    </form>
</div>

<div class="card">
    <h3>Пости</h3>
    {% for post in posts %}
    <div style="border-bottom: 1px solid #ddd; padding: 20px 0;">
        <div style="display: flex; align-items: start; margin-bottom: 10px;">
            <strong>{{ post.author.username }}</strong>
            <small style="color: #999; margin-left: 10px;">{{ post.created_at|date:"d.m.Y H:i" }}</small>
        </div>
        <p>{{ post.content }}</p>
        {% if post.image %}
        <img src="{{ post.image.url }}" alt="Post image" style="max-width: 100%; border-radius: 8px; margin-top: 10px;">
        {% endif %}
        
        <div style="margin-top: 15px;">
            <h4>Коментарі ({{ post.comments.count }})</h4>
            {% for comment in post.comments.all %}
            <div style="background: #f5f5f5; padding: 10px; border-radius: 6px; margin: 10px 0;">
                <strong>{{ comment.author.username }}</strong>
                <small style="color: #999; margin-left: 10px;">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
                <p style="margin-top: 5px;">{{ comment.content }}</p>
            </div>
            {% endfor %}
            
            <form method="post" action="{% url 'group_post_comment' post.id %}" style="margin-top: 10px;">
                {% csrf_token %}
                <input type="text" name="content" placeholder="Додати коментар..." required>
                <button type="submit">Коментувати</button>
            </form>
        </div>
    </div>
    {% empty %}
    <p>Поки що немає постів. Створіть перший!</p>
    {% endfor %}
</div>
{% else %}
<div class="card">
    <p>Приєднайтеся до групи, щоб бачити пости та коментарі.</p>
</div>
{% endif %}
{% endblock %}