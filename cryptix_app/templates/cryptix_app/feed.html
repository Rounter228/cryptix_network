{% extends 'cryptix_app/base.html' %}

{% block title %}–°—Ç—Ä—ñ—á–∫–∞ –Ω–æ–≤–∏–Ω{% endblock %}

{% block content %}
<!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ -->
<div class="card">
    <h3>–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Å—Ç</h3>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <textarea name="post_content" placeholder="–©–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?" rows="3" required></textarea>
        <div style="margin: 10px 0;">
            <label for="post_image" style="cursor: pointer; color: #1877f2;">üì∑ –î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ</label>
            <input type="file" name="post_image" id="post_image" accept="image/*" style="display: none;">
        </div>
        <button type="submit">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
        <a href="{% url 'my_posts' %}" style="margin-left: 10px;">
            <button type="button" style="background: #999;">–ú–æ—ó –ø–æ—Å—Ç–∏</button>
        </a>
    </form>
</div>

<!-- –õ–µ–Ω—Ç–∞ –ø–æ—Å—Ç–æ–≤ -->
{% for post in posts %}
<div class="card">
    <div style="display: flex; align-items: start; margin-bottom: 15px;">
        <a href="{% url 'user_profile_view' post.author.username %}" style="text-decoration: none; color: inherit;">
            {% if post.author.profile.avatar %}
            <img src="{{ post.author.profile.avatar.url }}" alt="{{ post.author.username }}" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
            {% else %}
            <div style="width: 40px; height: 40px; border-radius: 50%; background: #1877f2; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px;">
                {{ post.author.username|first|upper }}
            </div>
            {% endif %}
        </a>
        <div style="flex: 1;">
            <strong><a href="{% url 'user_profile_view' post.author.username %}" style="text-decoration: none; color: #333;">{{ post.author.username }}</a></strong>
            <br>
            <small style="color: #999;">{{ post.created_at|date:"d.m.Y H:i" }}</small>
        </div>
        {% if post.author == user %}
        <form method="post" action="{% url 'post_delete' post.id %}" style="margin: 0;" onsubmit="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ—Å—Ç?');">
            {% csrf_token %}
            <button type="submit" style="background: #f44336; padding: 5px 10px; font-size: 12px;">–í–∏–¥–∞–ª–∏—Ç–∏</button>
        </form>
        {% endif %}
    </div>
    
    <p style="margin-bottom: 15px; white-space: pre-wrap;">{{ post.content }}</p>
    
    {% if post.image %}
    <img src="{{ post.image.url }}" alt="Post image" style="max-width: 100%; border-radius: 8px; margin-bottom: 15px;">
    {% endif %}
    
    <div style="border-top: 1px solid #ddd; padding-top: 10px; margin-bottom: 10px;">
        <form method="post" action="{% url 'post_like' post.id %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="like-button {% if post.id in liked_posts_ids %}liked{% endif %}">
                üëç {{ post.likes_count }}
            </button>
        </form>
        <span style="color: #999; margin-left: 15px;">üí¨ {{ post.comments_count }}</span>
    </div>
    
    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
    <div style="background: #f5f5f5; padding: 10px; border-radius: 6px; margin-top: 10px;">
        {% for comment in post.comments.all %}
        <div class="comment-item {% if not forloop.last %}comment-border{% endif %}">
            <strong><a href="{% url 'user_profile_view' comment.author.username %}" style="text-decoration: none; color: #333;">{{ comment.author.username }}</a></strong>
            <small style="color: #999; margin-left: 5px;">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
            <p style="margin-top: 5px;">{{ comment.content }}</p>
        </div>
        {% endfor %}
        
        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
        <form method="post" action="{% url 'post_comment' post.id %}" style="margin-top: 10px;">
            {% csrf_token %}
            <input type="text" name="content" placeholder="–ù–∞–ø–∏—Å–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä..." required style="margin: 0;">
            <button type="submit" style="margin-top: 5px; padding: 8px 15px; font-size: 13px;">–ö–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏</button>
        </form>
    </div>
</div>
{% empty %}
<div class="card">
    <p style="text-align: center; color: #666;">
        –ù–µ–º–∞—î –ø–æ—Å—Ç—ñ–≤ —É —Å—Ç—Ä—ñ—á—Ü—ñ. 
        <a href="{% url 'users_list' %}">–ó–Ω–∞–π–¥—ñ—Ç—å –¥—Ä—É–∑—ñ–≤</a> –∞–±–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å —Å–≤—ñ–π –ø–µ—Ä—à–∏–π –ø–æ—Å—Ç!
    </p>
</div>
{% endfor %}

<style>
    .like-button {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
        color: #999;
        padding: 5px 10px;
    }
    
    .like-button.liked {
        color: #1877f2;
    }
    
    .comment-item {
        margin-bottom: 10px;
        padding-bottom: 10px;
    }
    
    .comment-border {
        border-bottom: 1px solid #ddd;
    }
</style>
{% endblock %}