{% extends 'cryptix_app/base.html' %}

{% block title %}Повідомлення{% endblock %}

{% block content %}
<div class="card">
    <h2>Мої чати</h2>
    {% for data in conversations_data %}
    <a href="{% url 'conversation_detail' data.conversation.id %}" style="text-decoration: none; color: inherit;">
        <div class="conversation-item {% if data.unread_count %}unread{% endif %}">
            <div style="display: flex; justify-content: space-between;">
                <strong>{{ data.other_user.username }}</strong>
                {% if data.unread_count %}
                    <span class="unread-badge">
                        {{ data.unread_count }}
                    </span>
                {% endif %}
            </div>
            {% if data.last_message %}
                <div style="color: #666; font-size: 14px; margin-top: 5px;">
                    {{ data.last_message.content|truncatewords:10 }}
                </div>
                <div style="color: #999; font-size: 12px; margin-top: 3px;">
                    {{ data.last_message.created_at|date:"d.m.Y H:i" }}
                </div>
            {% endif %}
        </div>
    </a>
    {% empty %}
    <p>В вас поки немає чатів. <a href="{% url 'friends_list' %}">Напишіть другові</a></p>
    {% endfor %}
</div>

<style>
    .conversation-item {
        border-bottom: 1px solid #ddd;
        padding: 15px 0;
        cursor: pointer;
        background: transparent;
    }
    .conversation-item.unread {
        background: #f0f8ff;
    }
    .conversation-item:hover {
        background: #f5f5f5;
    }
    .unread-badge {
        background: #1877f2;
        color: white;
        border-radius: 50%;
        padding: 2px 8px;
        font-size: 12px;
    }
</style>
{% endblock %}